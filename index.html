<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, viewport-fit=cover, minimum-scale=1, maximum-scale=5, user-scalable=yes, shrink-to-fit=no">
    <meta name="apple-mobile-web-app-title" content="Together AS One">
    <meta name="application-name" content="Together AS One">
    <meta name="theme-color" content="#FFCC00" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <meta name="msapplication-TileColor" content="#FFCC00">
    <meta name="msapplication-TileImage" content="./images/image-192.png">
    <meta name="msapplication-config" content="./browserconfig.xml">
    <title>Together AS One - SACCO Management System</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="./images/32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./images/16x16.png">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="./images/180x180.png">
    <link rel="apple-touch-icon" sizes="144x144" href="./images/144x144.png">
    <link rel="apple-touch-icon" sizes="64x64" href="./images/64x64.png">
    
    <!-- PWA Splash Screens for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-standalone" content="yes">

    <!-- Bootstrap 5 CSS (Local) -->
    <link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css">

    <!-- Remix Icons (Local) -->
    <link rel="stylesheet" href="css/remixicon.css">

    <!-- SweetAlert2 CSS (Bootstrap 5 Theme) -->
    <link rel="stylesheet" href="vendor/sweetalert/themes/bootstrap-5.css">

    <!-- Theme Customization (overrides Bootstrap defaults) -->
    <link rel="stylesheet" href="css/theme.css">

    <!-- Additional Custom Styles (complementary to Bootstrap) -->
    <link rel="stylesheet" href="css/style.css">

    <!-- Enhanced Form Controls -->
    <link rel="stylesheet" href="css/form-enhanced.css">

    <!-- Advanced Charts Styling -->
    <link rel="stylesheet" href="css/advanced-charts.css">

    <!-- Select2 CSS -->
    <link rel="stylesheet" href="vendor/select2-develop/select2-develop/dist/css/select2.min.css">

    <!-- Select2 Custom Styling -->
    <link rel="stylesheet" href="css/select2-custom.css">

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <style>
        /* Force hide transaction detail cards on page load */
        #allTransactionsCard,
        #loansDetailsCard,
        #savingsDetailsCard {
            display: none !important;
            visibility: hidden !important;
        }
    </style>
    </head>

<body>
    <!-- Splash Screen -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <img src="./images/image-192.png" alt="Together AS One" class="splash-logo">
            <h1 class="splash-title">Together AS One</h1>
            <p class="splash-subtitle">SACCO Management System</p>
            <div class="splash-loader">
                <div class="spinner"></div>
            </div>
            <p class="splash-loading-text">Loading...</p>
        </div>
    </div>

    <!-- Install Reminder Banner (Desktop) -->
    <div id="installBanner" class="install-banner" style="display: none;">
        <div class="install-banner-content">
            <div class="install-banner-left">
                <i class="ri-cloud-download-line"></i>
                <div>
                    <strong>Install Together AS One App</strong>
                    <p>Get offline access and a faster experience</p>
                </div>
            </div>
            <div class="install-banner-actions">
                <button id="installBannerBtn" class="btn btn-sm btn-primary">Install</button>
                <button id="dismissBannerBtn" class="btn btn-sm btn-outline-secondary">Dismiss</button>
            </div>
        </div>
    </div>

    <div class="min-vh-100 d-flex flex-column">
        <!-- Header -->
        <header class="mb-0"
            style="width: 100%; background: linear-gradient(135deg, #FFCC00 0%, #FFDC4E 50%, #FFE6B3 100%); box-shadow: 0 8px 32px rgba(255, 204, 0, 0.35); position: relative; overflow: hidden;">
            <!-- Decorative background elements -->
            <div
                style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 15% 50%, rgba(255,255,255,0.15) 0%, transparent 50%), radial-gradient(circle at 85% 85%, rgba(255,255,255,0.1) 0%, transparent 50%); pointer-events: none; z-index: 0;">
            </div>

            <div class="container-fluid"
                style="padding-left: 1.5rem; padding-right: 1.5rem; padding-top: 2.5rem; padding-bottom: 2.5rem; position: relative; z-index: 1;">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="mb-1 responsive-header"
                            style="letter-spacing: -1.5px; color: #0f0f0f; text-shadow: 0 2px 8px rgba(0,0,0,0.12); font-weight: 800; margin-bottom: 0.5rem;">
                            <img src="./images/image-192.png" alt="Together AS One" style="height: 2.5rem; width: auto; vertical-align: middle; margin-right: 0.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);"> Together AS One
                        </h1>
                        <p class="mb-0 responsive-subheader" style="opacity: 0.95; color: #1a1a1a; font-weight: 500;">
                            Savings and Credit Cooperative Society Management
                        </p>
                    </div>
                    <div class="col-md-4 text-end d-flex justify-content-end gap-2 flex-wrap align-items-center">
                        <button id="pwaInstallBtn" class="btn btn-dark btn-sm pwa-install-btn" 
                            style="background: rgba(0,0,0,0.15); border: 1px solid rgba(0,0,0,0.2); color: #0f0f0f; font-weight: 600; padding: 0.5rem 1rem; border-radius: 8px; transition: all 0.3s ease; display: none !important;"
                            onmouseover="if(this.style.display !== 'none') {this.style.background='rgba(0,0,0,0.25)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'}"
                            onmouseout="if(this.style.display !== 'none') {this.style.background='rgba(0,0,0,0.15)'; this.style.boxShadow='none'}">
                            <i class="ri-download-line" style="margin-right: 0.5rem;"></i>Install App
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="" style="background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.08); z-index: 100;">
            <div class="container-fluid">
                <ul class="nav professional-tabs" role="tablist"
                    style="border-bottom: none; padding: 0;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active nav-btn" id="dashboard-tab" data-page="dashboard" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üìä</span>Dashboard
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="members-tab" data-page="members" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üë•</span>Members
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="loans-tab" data-page="loans" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üí∞</span>Loans
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="payments-tab" data-page="payments" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üí≥</span>Payments
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="reports-tab" data-page="reports" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üìà</span>Reports
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="transactions-tab" data-page="transactions" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üìä</span>Transactions
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link nav-btn" id="savings-tab" data-page="savings" type="button">
                            <span style="font-size: 1.1rem; margin-right: 0.5rem;">üè¶</span>Savings
                        </button>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow-1" style="background: linear-gradient(135deg, var(--light) 0%, #ffffff 100%);">
            <div class="container-fluid" style="padding: 0; margin: 0 auto; max-width: 100%;">
                <!-- Dashboard Page -->
                <section id="dashboard" class="page active">
                    <div class="mb-4">
                        <h2 class="mb-4">Dashboard</h2>

                        <!-- Stats Grid -->
                        <div class="row g-4 mb-5">
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">üë• Total Members</p>
                                        <p class="stat-number mb-0" id="totalMembers">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">üìã Active Loans</p>
                                        <p class="stat-number mb-0" id="activeLoans">0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">üí∞ Total Loaned</p>
                                        <p class="stat-number mb-0" id="totalLoaned">UGX 0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">‚úÖ Total Repaid</p>
                                        <p class="stat-number mb-0" id="totalRepaid">UGX 0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm bg-primary-light">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">üìä Outstanding</p>
                                        <p class="stat-number text-primary mb-0" id="outstandingBalance">UGX 0</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-lg-4 col-xl-2">
                                <div class="card stat-card shadow-sm bg-warning-light">
                                    <div class="card-body p-4">
                                        <p class="card-text text-muted mb-3"
                                            style="font-size: 0.85rem; font-weight: 500;">‚ö†Ô∏è Overdue</p>
                                        <p class="stat-number text-warning mb-0" id="overdueLoans">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Recent Activity -->
                        <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">üìù Recent Activity</h5>
                                <select class="virtual-select" id="activityMemberFilter" placeholder="Search members...">
                                    <option value="">All Members</option>
                                </select>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead >
                                            <tr>
                                                <th>Member</th>
                                                <th>Type</th>
                                                <th>Amount</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentActivity">
                                            <tr>
                                                <td colspan="4" class="text-center text-muted py-4">No recent activity
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div id="activitiesPagination"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Members Page -->
                <section id="members" class="page">
                    <!-- Page Header -->
                    <div class="d-flex justify-content-between align-items-center mb-5 gap-3 flex-wrap">
                        <div>
                            <h2 class="mb-2">Members Management</h2>
                            <p class="text-muted mb-0">Manage and monitor all SACCO members</p>
                        </div>
                        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#memberFormModal">
                            <i class="ri-add-line"></i> Add New Member
                        </button>
                    </div>

                    <!-- Key Metrics Cards -->
                    <div class="row g-4 mb-5" style="margin-left: 2rem; margin-right: 2rem;">
                        <div class="col-md-6 col-lg-3">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-2" style="font-size: 0.85rem; font-weight: 600;">TOTAL MEMBERS</p>
                                            <h3 class="mb-0" id="totalMembersMetric">0</h3>
                                        </div>
                                        <span style="font-size: 1.8rem;">üë•</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-2" style="font-size: 0.85rem; font-weight: 600;">ACTIVE MEMBERS</p>
                                            <h3 class="mb-0" id="activeMembersMetric">0</h3>
                                        </div>
                                        <span style="font-size: 1.8rem;">‚úÖ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-2" style="font-size: 0.85rem; font-weight: 600;">INACTIVE MEMBERS</p>
                                            <h3 class="mb-0" id="inactiveMembersMetric">0</h3>
                                        </div>
                                        <span style="font-size: 1.8rem;">‚è∏Ô∏è</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-4">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <p class="text-muted mb-2" style="font-size: 0.85rem; font-weight: 600;">NEW THIS MONTH</p>
                                            <h3 class="mb-0" id="newMembersMetric">0</h3>
                                        </div>
                                        <span style="font-size: 1.8rem;">üìà</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Controls & Filters -->
                    <div class="card border-0 shadow-sm mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                        <div class="card-body p-4">
                            <div class="row g-3 align-items-end">
                                <div class="col-lg-4">
                                    <label for="memberSearch" class="form-label fw-600 mb-2">Search Members</label>
                                    <div class="input-group input-group-lg">
                                        <span class="input-group-text bg-white border-end-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.2rem; height: 1.2rem;"><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>
                                        </span>
                                        <input type="text" id="memberSearch" class="form-control form-control-enhanced border-start-0"
                                            placeholder="Name, email, phone, or ID...">
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <label for="memberStatusFilter" class="form-label fw-600 mb-2">Status</label>
                                    <select id="memberStatusFilter" class="form-select form-select-lg">
                                        <option value="">All Members</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="suspended">Suspended</option>
                                    </select>
                                </div>
                                <div class="col-lg-3">
                                    <label for="memberSortBy" class="form-label fw-600 mb-2">Sort By</label>
                                    <select id="memberSortBy" class="form-select form-select-lg">
                                        <option value="recent">Most Recent</option>
                                        <option value="name">Name (A-Z)</option>
                                        <option value="joined">Joined Date</option>
                                    </select>
                                </div>
                                <div class="col-lg-2">
                                    <button class="btn btn-outline-secondary w-100" id="clearFiltersBtn">
                                        <i class="ri-refresh-line"></i> Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- View Toggle -->
                    <div class="d-flex justify-content-between align-items-center mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                        <p class="text-muted mb-0">
                            <strong id="membersCountDisplay">0</strong> members found
                        </p>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm btn-outline-primary active view-btn" id="cardViewBtn" data-view="card">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem; margin-right: 0.4rem; vertical-align: -2px;"><path d="M22 12.999V20C22 20.5523 21.5523 21 21 21H13V12.999H22ZM11 12.999V21H3C2.44772 21 2 20.5523 2 20V12.999H11ZM11 3V10.999H2V4C2 3.44772 2.44772 3 3 3H11ZM21 3C21.5523 3 22 3.44772 22 4V10.999H13V3H21Z"></path></svg> Grid View
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary view-btn" id="tableViewBtn" data-view="table">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem; margin-right: 0.4rem; vertical-align: -2px;"><path d="M7 14V3H3C2.44772 3 2 3.44772 2 4V14H7ZM15 14V3H9V14H15ZM22 14V4C22 3.44772 21.5523 3 21 3H17V14H22ZM21 21C21.5523 21 22 20.5523 22 20V16H2V20C2 20.5523 2.44772 21 3 21H21Z"></path></svg> Table View
                            </button>
                        </div>
                    </div>

                    <!-- Members Grid/Table Container -->
                    <div id="membersList" class="row g-4" style="min-height: 400px; margin-left: 2rem; margin-right: 2rem;">
                        <div class="col-12">
                            <div class="text-center py-5">
                                <p class="text-muted">No members found. Click "Add New Member" to get started.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div id="membersPagination" class="mt-5" style="margin-left: 2rem; margin-right: 2rem;"></div>
                </section>

                <!-- Member Form Modal -->
                <div class="modal fade" id="memberFormModal" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content border-0">
                            <div class="modal-header bg-primary text-white border-0">
                                <h5 class="modal-title fw-700">Register New Member</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="memberForm">
                                    <div class="row g-4">
                                        <div class="col-12">
                                            <label for="memberName" class="form-label fw-600">Full Name</label>
                                            <input type="text" class="form-control form-control-lg" id="memberName"
                                                placeholder="e.g., John Doe" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="memberEmail" class="form-label fw-600">Email Address</label>
                                            <input type="email" class="form-control form-control-lg" id="memberEmail"
                                                placeholder="john@example.com" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="memberPhone" class="form-label fw-600">Phone Number</label>
                                            <input type="tel" class="form-control form-control-lg" id="memberPhone"
                                                placeholder="+256 700 000 000" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="memberIdNo" class="form-label fw-600">ID Number</label>
                                            <input type="text" class="form-control form-control-lg" id="memberIdNo"
                                                placeholder="Auto-generated" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="memberStatus" class="form-label fw-600">Status</label>
                                            <select class="form-select form-select-lg" id="memberStatus" required>
                                                <option value="active">Active</option>
                                                <option value="inactive">Inactive</option>
                                                <option value="suspended">Suspended</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer border-top p-4 gap-2">
                                <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary btn-lg" form="memberForm">Register Member</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loans Page -->
                <section id="loans" class="page">
                    <div class="d-flex justify-content-between align-items-center mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                         <h2 class="mb-0">Loans Management</h2>
                    </div>

                    <!-- Loan Forms Tabs -->
                    <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem; margin-bottom: 2rem;">
                        <div class="card-header p-0 border-bottom">
                            <ul class="nav nav-tabs" role="tablist" style="border-bottom: none;">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="newLoanTab" data-bs-toggle="tab" data-bs-target="#newLoanContent" type="button" role="tab">
                                        <i class="ri-add-circle-line" style="margin-right: 0.5rem;"></i>New Loan
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="topUpLoanTab" data-bs-toggle="tab" data-bs-target="#topUpLoanContent" type="button" role="tab">
                                        <i class="ri-wallet-2-line" style="margin-right: 0.5rem;"></i>Top Up Loan
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <div class="tab-content">
                            <!-- New Loan Tab -->
                            <div class="tab-pane fade show active" id="newLoanContent" role="tabpanel">
                                <div class="card-body p-4">
                                    <form id="loanForm">
                                        <div class="mb-3">
                                            <label for="borrowerType" class="form-label fw-600">Borrower Type</label>
                                            <select class="form-select form-select-lg" id="borrowerType" required onchange="App.updateBorrowerOptions()">
                                                <option value="" disabled selected>Select borrower type...</option>
                                                <option value="member">Member</option>
                                                <option value="non-member">Non-Member</option>
                                            </select>
                                        </div>
                                        <div class="mb-3" id="loanMemberWrapper" style="display: none;">
                                            <label for="loanMember" class="form-label fw-600">Member</label>
                                            <select class="form-select form-select-lg" id="loanMember">
                                                <option value="">Select member...</option>
                                            </select>
                                        </div>
                                        <div class="mb-3" id="nonMemberNameWrapper" style="display: none;">
                                            <label for="nonMemberName" class="form-label fw-600">Non-Member Name</label>
                                            <input type="text" class="form-control form-control-lg" id="nonMemberName" placeholder="Enter full name" />
                                        </div>
                                        <div class="mb-3">
                                            <label for="loanType" class="form-label fw-600">Loan Type</label>
                                            <select class="form-select form-select-lg" id="loanType" required onchange="App.updateInterestRate(); App.calculateMonthlyInstallment();">
                                                <option value="" disabled selected>Select loan type...</option>
                                                <option value="normal">Normal Loan</option>
                                                <option value="emergency">Emergency Loan</option>
                                                <option value="non-member">Non-Member Loan</option>
                                            </select>
                                        </div>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="loanAmount" class="form-label fw-600">Amount (UGX)</label>
                                                <input type="number" class="form-control form-control-lg" id="loanAmount"
                                                    placeholder="Loan Amount" min="1" required oninput="App.calculateMonthlyInstallment()">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="loanTerm" class="form-label fw-600">Term (months)</label>
                                                <input type="number" class="form-control form-control-lg" id="loanTerm"
                                                    placeholder="Loan Term" min="1" max="60" required oninput="App.calculateMonthlyInstallment()">
                                            </div>
                                        </div>
                                        <div class="row g-3 mt-2">
                                            <div class="col-md-6">
                                                <label for="interestRate" class="form-label fw-600">Interest Rate (%)</label>
                                                <input type="number" class="form-control form-control-lg" id="interestRate"
                                                    placeholder="Interest Rate" min="0" max="100" step="0.1" value="2" readonly>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="loanDate" class="form-label fw-600">Loan Date</label>
                                                <input type="date" class="form-control form-control-lg" id="loanDate" required>
                                            </div>
                                        </div>
                                        <div class="alert alert-info mt-3 mb-3" role="alert">
                                            <div class="d-flex align-items-center">
                                                <i class="ri-information-line" style="font-size: 1.2rem; margin-right: 0.5rem;"></i>
                                                <div>
                                                    <strong>Monthly Installment:</strong> <span id="monthlyInstallment" style="font-size: 1.1rem; color: #0c63e4; font-weight: 600;">UGX 0</span>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-lg w-100">Create Loan</button>
                                    </form>
                                </div>
                            </div>

                            <!-- Top Up Loan Tab -->
                            <div class="tab-pane fade" id="topUpLoanContent" role="tabpanel">
                                <div class="card-body p-4">
                                    <form id="topUpLoanForm">
                                        <div class="mb-3">
                                            <label for="topUpSelectLoan" class="form-label fw-600">Select Loan to Top Up</label>
                                            <select class="form-select form-select-lg" id="topUpSelectLoan">
                                                <option value="">Choose a loan...</option>
                                            </select>
                                        </div>
                                        <div class="alert alert-light border border-secondary mt-3 mb-3" role="alert">
                                            <h6 class="alert-heading mb-3">Current Loan Details</h6>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <p class="mb-1"><small class="text-muted">Original Amount</small></p>
                                                    <p class="h6 mb-0" id="currentLoanAmount">UGX 0</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-1"><small class="text-muted">Interest Rate</small></p>
                                                    <p class="h6 mb-0" id="currentLoanRate">0%</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-1"><small class="text-muted">Remaining Balance</small></p>
                                                    <p class="h6 mb-0" id="currentLoanBalance">UGX 0</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-1"><small class="text-muted">Due Date</small></p>
                                                    <p class="h6 mb-0" id="currentLoanDueDate">-</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="topUpAmount" class="form-label fw-600">Top Up Amount (UGX)</label>
                                            <input type="number" class="form-control form-control-lg" id="topUpAmount" placeholder="Top Up Amount" min="1" required oninput="App.calculateNewTopUpTotal()">
                                        </div>
                                        <div class="mb-3">
                                            <label for="topUpDate" class="form-label fw-600">Top Up Date</label>
                                            <input type="date" class="form-control form-control-lg" id="topUpDate" required>
                                        </div>
                                        <div class="alert alert-success mt-3 mb-3" role="alert">
                                            <strong>New Total Amount:</strong> <span id="newTopUpTotal" style="font-size: 1.1rem; color: #155724; font-weight: 600;">UGX 0</span>
                                        </div>
                                        <button type="submit" class="btn btn-success btn-lg w-100">Process Top Up</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                <div
                                    class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Loan Records</h5>
                                    <div class="input-group" style="max-width: 200px;">
                                        <span class="input-group-text bg-white border-end-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem;"><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>
                                        </span>
                                        <input type="text" id="loanSearch" class="form-control form-control-enhanced border-start-0"
                                            placeholder="Search loans...">
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0">
                                            <thead >
                                                <tr>
                                                    <th>Member</th>
                                                    <th>Loan Type</th>
                                                    <th>Amount</th>
                                                    <th>Interest</th>
                                                    <th>Monthly Payment</th>
                                                    <th>Due Date</th>
                                                    <th>Status</th>
                                                    <th>Remaining</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="loansTableBody">
                                                <tr>
                                                    <td colspan="7" class="text-center text-muted py-4">No loans created
                                                        yet</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div id="loansPagination"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Payments Page -->
                <section id="payments" class="page">
                    <div class="d-flex justify-content-between align-items-center mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                        <h2 class="mb-0">Payment Management</h2>
                        <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#recordPaymentModal">
                            <i class="ri-add-circle-line"></i> Record Payment
                        </button>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                <div class="card-header">
                                    <h5 class="mb-0">Payment History</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0">
                                            <thead >
                                                <tr>
                                                    <th>Member</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Loan Details</th>
                                                </tr>
                                            </thead>
                                            <tbody id="paymentsTableBody">
                                                <tr>
                                                    <td colspan="4" class="text-center text-muted py-4">No payments
                                                        recorded yet</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div id="paymentsPagination"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reports Page -->
                <section id="reports" class="page">
                    <h2 class="mb-4">Reports & Analytics</h2>

                    <div class="row g-3 mb-4">
                         <div class="col-lg-6">
                             <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">Member Details</h5>
                                 </div>
                                <div class="card-body">
                                    <label for="reportMember" class="form-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem; margin-right: 0.4rem; vertical-align: -2px;"><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>
                                        Select Member
                                    </label>
                                    <select class="virtual-select" id="reportMember" placeholder="Search member...">
                                        <option value="">Select Member</option>
                                    </select>
                                    <div id="memberReport" class="text-muted text-center py-4">
                                        Select a member to view details
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                             <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">Loan Summary</h5>
                                 </div>
                                <div class="card-body">
                                    <div id="loanReport" class="text-muted text-center py-4">
                                        No loans to display
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="card-header">
                             <h5 class="mb-0">Member Ranking (By Outstanding Balance)</h5>
                         </div>
                        <div class="card-body p-0">
                            <div id="rankingReport" class="text-muted text-center py-4">
                                No data available
                            </div>
                        </div>
                    </div>

                    <!-- Profits Section -->
                    <div class="row g-3 mt-4">
                        <div class="col-lg-6">
                             <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">üí∞ Total Profits Summary</h5>
                                 </div>
                                <div class="card-body">
                                    <div id="profitsSummary" class="text-muted text-center py-4">
                                        No loans to display
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                             <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">üìä Profit Distribution by Member</h5>
                                 </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="profitDoughnutChart" style="width: 100%; height: 350px;"></div>
                                    <div id="profitDistribution" class="text-muted text-center py-4">
                                        No data available
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Member Contributions to Profits -->
                    <div class="card border-0 shadow-sm mt-4" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="card-header">
                             <h5 class="mb-0">Member Contributions to Profits</h5>
                         </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead >
                                        <tr>
                                             <th>Member Name</th>
                                             <th>Loans Count</th>
                                             <th>Total Interest Generated</th>
                                             <th>% Share of Total Profits</th>
                                         </tr>
                                     </thead>
                                     <tbody id="memberProfitsTableBody">
                                         <tr>
                                             <td colspan="4" class="text-center text-muted py-4">No loans to display</td>
                                         </tr>
                                     </tbody>
                                 </table>
                             </div>
                         </div>
                     </div>

                    <!-- Analytics Charts Grid -->
                    <div class="row g-4 mt-4 mb-4">
                        <!-- Savings Trend Chart (Full Width) -->
                         <div class="col-12">
                                 <div class="card border-0 shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                     <h5 class="mb-0">üìà Savings Growth Trend</h5>
                                    <div class="d-flex gap-2 flex-wrap" style="align-items: center;">
                                        <input type="date" id="savingsTrendStartDate" class="form-control form-control-sm" style="max-width: 150px;" placeholder="Start Date">
                                        <input type="date" id="savingsTrendEndDate" class="form-control form-control-sm" style="max-width: 150px;" placeholder="End Date">
                                        <button class="btn btn-sm btn-outline-primary" id="exportSavingsTrendBtn" title="Export as PNG">
                                            <i class="ri-download-line"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="savingsTrendChart" style="width: 100%; height: 350px;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Top Members & Financial Summary (2 columns) -->
                        <div class="col-lg-6">
                             <div class="card border-0 shadow-sm h-100" style="margin-left: 2rem; margin-right: 2rem;">
                                  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                      <h5 class="mb-0">üìä Top Members by Savings</h5>
                                    <div class="d-flex gap-2 flex-wrap" style="align-items: center;">
                                        <input type="date" id="topMembersStartDate" class="form-control form-control-sm" style="max-width: 130px;" placeholder="Start">
                                        <input type="date" id="topMembersEndDate" class="form-control form-control-sm" style="max-width: 130px;" placeholder="End">
                                        <button class="btn btn-sm btn-outline-primary" id="exportTopMembersBtn" title="Export as PNG">
                                            <i class="ri-download-line"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="topMembersBarChart" style="width: 100%; height: 320px;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                             <div class="card border-0 shadow-sm h-100" style="margin-left: 2rem; margin-right: 2rem;">
                                  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                      <h5 class="mb-0">üí∞ Financial Summary Waterfall</h5>
                                    <button class="btn btn-sm btn-outline-primary" id="exportWaterfallBtn" title="Export as PNG">
                                        <i class="ri-download-line"></i> Export
                                    </button>
                                </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="financialWaterfallChart" style="width: 100%; height: 320px;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Period Comparison & Repayment Metrics (2 columns) -->
                         <div class="col-lg-6">
                             <div class="card border-0 shadow-sm h-100" style="margin-left: 2rem; margin-right: 2rem;">
                                  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                      <h5 class="mb-0">üìä Period Comparison Analysis</h5>
                                    <div class="d-flex gap-2 flex-wrap" style="align-items: center;">
                                        <select class="virtual-select" id="comparisonPeriodSelect" placeholder="Select period..." style="max-width: 150px;">
                                            <option value="monthly">Month-over-Month</option>
                                            <option value="yearly">Year-over-Year</option>
                                        </select>
                                        <button class="btn btn-sm btn-outline-primary" id="exportComparisonBtn" title="Export as PNG">
                                            <i class="ri-download-line"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="comparisonChart" style="width: 100%; height: 320px;"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                             <div class="card border-0 shadow-sm h-100" style="margin-left: 2rem; margin-right: 2rem;">
                                  <div class="card-header d-flex justify-content-between align-items-center flex-wrap gap-2">
                                      <h5 class="mb-0">üí≥ Loan Repayment Breakdown</h5>
                                    <button class="btn btn-sm btn-outline-primary" id="exportRepaymentBtn" title="Export as PNG">
                                        <i class="ri-download-line"></i> Export
                                    </button>
                                </div>
                                <div class="card-body" style="padding: 2rem;">
                                    <div id="repaymentMetricsChart" style="width: 100%; height: 320px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export All Charts as PDF -->
                    <div class="card border-0 shadow-sm mt-4 mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="card-header bg-primary text-white">
                             <h5 class="mb-0">üìã Export All Analytics</h5>
                         </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">Generate a comprehensive PDF report containing all charts and analysis</p>
                            <button class="btn btn-lg btn-primary" id="exportAllPdfBtn">
                                <i class="ri-file-pdf-line"></i> Export Complete PDF Report
                            </button>
                        </div>
                    </div>
                    </section>

                <!-- Transactions Page -->
                <section id="transactions" class="page">
                    <h2 class="mb-4" style="margin-left: 2rem; margin-right: 2rem;">Member Transaction History</h2>

                    <div class="row mb-4" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="col-lg-3">
                              <div class="card shadow-sm">
                                   <div class="card-header">
                                        <h5 class="mb-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem; margin-right: 0.4rem; vertical-align: -2px;"><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>
                                            Select Member
                                        </h5>
                                    </div>
                                   <div class="card-body">
                                       <select class="virtual-select" id="transactionMemberSelect" placeholder="Search member...">
                                               <option value="">Choose a member...</option>
                                           </select>
                                       </div>
                                   </div>
                               </div>
                           </div>
                      </div>

                      <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem; margin-top: 2rem; margin-bottom: 2rem;">
                           <div class="card-header">
                               <h5 class="mb-0">Transaction Summary</h5>
                           </div>
                          <div class="card-body">
                              <div class="row g-4" id="transactionSummary">
                                  <div class="col-md-4">
                                      <p class="text-muted small mb-2">Total Transactions</p>
                                      <p class="h5 mb-0" id="totalTransactionCount">0</p>
                                  </div>
                                  <div class="col-md-4">
                                      <p class="text-muted small mb-2">Total In</p>
                                      <p class="h5 mb-0" id="totalInAmount">UGX 0</p>
                                  </div>
                                  <div class="col-md-4">
                                      <p class="text-muted small mb-2">Total Out</p>
                                      <p class="h5 mb-0" id="totalOutAmount">UGX 0</p>
                                  </div>
                              </div>
                          </div>
                      </div>

                    <!-- All Transactions Table -->
                    <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem; display: none !important;" id="allTransactionsCard">
                        <div
                            class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">All Transactions</h5>
                            <button class="btn btn-sm btn-primary" id="exportTransactionsBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 0.9rem; height: 0.9rem; margin-right: 0.4rem; vertical-align: -2px;">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 2v6h6"/><path d="M12 15v3m0-7v3"/>
                                </svg>
                                Export
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead >
                                        <tr>
                                            <th>Date</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactionsTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">Select a member to view
                                                transactions</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="transactionsPagination"></div>
                        </div>
                    </div>

                    <!-- Loans Details -->
                    <div class="card border-0 shadow-sm mt-4" style="margin-left: 2rem; margin-right: 2rem; display: none !important; margin-bottom: 2rem;" id="loansDetailsCard">
                         <div class="card-header">
                             <h5 class="mb-0">Loan Details</h5>
                         </div>
                        <div class="card-body p-0">
                             <div class="table-responsive">
                                 <table class="table table-hover table-sm mb-0">
                                     <thead >
                                         <tr>
                                             <th>Loan ID</th>
                                             <th>Amount</th>
                                             <th>Term</th>
                                             <th>Interest Rate</th>
                                             <th>Loan Date</th>
                                             <th>Due Date</th>
                                             <th>Status</th>
                                             <th class="d-none d-md-table-cell">Payment Progress</th>
                                             <th>Remaining</th>
                                         </tr>
                                     </thead>
                                    <tbody id="memberLoansDetailsBody">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-4">No loans to display</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="loanDetailsPagination"></div>
                        </div>
                    </div>

                    <!-- Savings Details -->
                    <div class="card border-0 shadow-sm mt-4" style="margin-left: 2rem; margin-right: 2rem; display: none !important; margin-bottom: 2rem;" id="savingsDetailsCard">
                         <div class="card-header">
                             <h5 class="mb-0">Savings Details</h5>
                         </div>
                        <div class="card-body p-0">
                            <div id="memberSavingsDetails" class="text-muted text-center py-4">
                                No savings to display
                            </div>
                            <div id="savingsDetailsPagination"></div>
                        </div>
                    </div>
                </section>

                <!-- Savings Page -->
                <section id="savings" class="page">
                    <h2 class="mb-4" style="margin-left: 2rem; margin-right: 2rem;">Member Savings</h2>

                    <!-- Add Savings & Withdrawal Forms -->
                    <div class="row mb-4">
                        <div class="col-lg-4 mb-4">
                            <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">Record Saving</h5>
                                 </div>
                                <div class="card-body">
                                    <form id="savingForm">
                                         <div class="mb-3">
                                             <label for="savingMember" class="form-label">Member</label>
                                             <select class="virtual-select" id="savingMember" placeholder="Search member...">
                                                 <option value="" disabled selected>Select member...</option>
                                             </select>
                                         </div>
                                        <div class="mb-3">
                                            <label for="savingAmount" class="form-label">Amount (UGX)</label>
                                            <input type="number" class="form-control" id="savingAmount"
                                                placeholder="Savings Amount" min="1" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="savingDate" class="form-label">Saving Date</label>
                                            <input type="date" class="form-control" id="savingDate" required>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">Record Saving</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 mb-4">
                            <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                                 <div class="card-header">
                                     <h5 class="mb-0">Withdrawal Request</h5>
                                 </div>
                                <div class="card-body">
                                    <form id="withdrawalForm">
                                         <div class="mb-3">
                                             <label for="withdrawalMember" class="form-label">
                                                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1rem; height: 1rem; margin-right: 0.4rem; vertical-align: -2px;"><path d="M18.031 16.6168L22.3137 20.8995L20.8995 22.3137L16.6168 18.031C15.0769 19.263 13.124 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2C15.968 2 20 6.032 20 11C20 13.124 19.263 15.0769 18.031 16.6168ZM16.0247 15.8748C17.2475 14.6146 18 12.8956 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18C12.8956 18 14.6146 17.2475 15.8748 16.0247L16.0247 15.8748Z"></path></svg>
                                                 Member
                                             </label>
                                             <select class="virtual-select" id="withdrawalMember" placeholder="Search member...">
                                                 <option value="">Select Member</option>
                                             </select>
                                         </div>
                                        <div class="mb-3">
                                            <label for="withdrawalAmount" class="form-label">Amount (UGX)</label>
                                            <input type="number" class="form-control" id="withdrawalAmount"
                                                placeholder="Withdrawal Amount" min="1" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="withdrawalDate" class="form-label">Withdrawal Date</label>
                                            <input type="date" class="form-control" id="withdrawalDate" required>
                                        </div>
                                        <button type="submit" class="btn btn-warning w-100">Record Withdrawal</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Overall Savings Stats (moved here) -->
                         <div class="col-lg-8">
                             <div class="card border-0 shadow-sm savings-card" style="margin-left: 2rem; margin-right: 2rem;">
                                <div class="card-body p-4" style="position: relative; z-index: 1;">
                                    <div class="row align-items-center">
                                        <div class="col-md-6 mb-4 mb-md-0">
                                            <p class="savings-label mb-2" style="white-space: nowrap;">üí∞ Total Collective Savings</p>
                                            <p class="savings-amount mb-0" id="totalSavings" style="white-space: nowrap;">UGX 0</p>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="savings-grid">
                                                <div class="savings-stat">
                                                    <p class="savings-stat-label">Active Savers</p>
                                                    <p class="savings-stat-value" id="activeSavers">0</p>
                                                </div>
                                                <div class="savings-stat">
                                                    <p class="savings-stat-label">Avg. Savings</p>
                                                    <p class="savings-stat-value" id="avgSavings">UGX 0</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Savings by Member -->
                    <div class="card shadow-sm" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="card-header">
                             <h5 class="mb-0">Savings by Member</h5>
                         </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0 savings-table">
                                    <thead>
                                        <tr>
                                            <th>Member Name</th>
                                            <th>Total Savings</th>
                                            <th>Contributions Count</th>
                                            <th>Last Contribution</th>
                                            <th>Avg. Contribution</th>
                                        </tr>
                                    </thead>
                                    <tbody id="savingsTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">No savings data
                                                available</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="savingsPagination"></div>
                        </div>
                    </div>

                    <!-- Savings Growth Chart -->
                    <div class="card border-0 shadow-sm mt-4" style="margin-left: 2rem; margin-right: 2rem;">
                         <div class="card-header">
                             <h5 class="mb-0">Savings Distribution</h5>
                         </div>
                        <div class="card-body">
                            <div id="savingsDistribution" class="text-muted text-center py-4">
                                No data available
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-white text-center py-4 mt-auto"
            style="background: linear-gradient(135deg, #0f172a, #1e293b); border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="container-fluid">
                <p class="mb-0 small" style="font-size: 0.9rem;">
                    &copy; 2025 <strong>Together AS One</strong>. All data stored locally in your browser.
                </p>
            </div>
        </footer>

        <!-- Features Sidebar Panel -->
        <div id="featuresSidebar" class="features-sidebar">
            <div class="sidebar-header">
                <h5 class="mb-0">Settings & Features</h5>
                <button class="btn-close-sidebar" id="closeSidebarBtn" title="Close">√ó</button>
            </div>

            <div class="sidebar-content">
                <!-- Data Management Section -->
                <div class="feature-section">
                    <h6 class="feature-title">üíæ Data Management</h6>
                    <p class="feature-desc">Backup, restore, and manage your data</p>
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-sm btn-primary w-100" id="exportBtn">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 0.9rem; height: 0.9rem; margin-right: 0.4rem; vertical-align: -2px;">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/><path d="M14 2v6h6"/><path d="M12 15v3m0-7v3"/>
                                </svg>
                                Export
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-sm btn-info w-100" id="backupBtn">üíæ Backup</button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-sm btn-success w-100" id="restoreBtn"
                                onclick="document.getElementById('restoreInput').click()">üîÑ Restore</button>
                        </div>
                        <input type="file" id="restoreInput" accept=".json" style="display: none;">
                    </div>
                </div>

                <!-- Audit & Admin Section -->
                <div class="feature-section">
                    <h6 class="feature-title">üìã Audit & Admin</h6>
                    <p class="feature-desc">View audit logs and system administration</p>
                    <div class="row g-2">
                        <div class="col-6">
                            <button class="btn btn-sm btn-secondary w-100" id="auditBtn">üìã Audit Log</button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-sm btn-danger w-100" id="resetBtn">‚ö†Ô∏è Reset</button>
                        </div>
                    </div>
                </div>

                <!-- QR Code Section -->
                <div class="feature-section">
                    <h6 class="feature-title">üîÑ QR Code Verification</h6>
                    <p class="feature-desc">Generate QR codes with member details for quick verification</p>
                    <button class="btn btn-sm btn-primary w-100" id="generateQRBtn">Generate QR Code</button>
                    <div id="qrPreview" class="qr-preview mt-2" style="display:none;"></div>
                </div>

                <!-- Mobile Optimization Section -->
                <div class="feature-section">
                    <h6 class="feature-title"><i class="ri-smartphone-line"></i> Mobile Optimization</h6>
                    <p class="feature-desc">Optimize display and layout for your device</p>
                    
                    <!-- Toggle Options Container -->
                    <div class="mobile-options-container">
                        <!-- Option 1: Mobile Optimization -->
                        <div class="mobile-toggle-card">
                            <div class="toggle-left">
                                <label for="mobileOptimizeToggle" class="toggle-label">
                                    <i class="ri-smartphone-line"></i> Enable Mobile Optimization
                                </label>
                                <p class="toggle-hint">Responsive design for your screen</p>
                            </div>
                            <div class="toggle-right">
                                <input class="form-check-input toggle-checkbox" type="checkbox" id="mobileOptimizeToggle" checked>
                            </div>
                        </div>

                        <!-- Option 2: Compact View -->
                        <div class="mobile-toggle-card">
                            <div class="toggle-left">
                                <label for="compactViewToggle" class="toggle-label">
                                    <i class="ri-layout-line"></i> Use Compact View
                                </label>
                                <p class="toggle-hint">Space-saving layout for better use</p>
                            </div>
                            <div class="toggle-right">
                                <input class="form-check-input toggle-checkbox" type="checkbox" id="compactViewToggle" checked>
                            </div>
                        </div>

                        <!-- Option 3: Font Size -->
                        <div class="mobile-toggle-card font-size-card">
                            <div class="toggle-left">
                                <label class="toggle-label">
                                    <i class="ri-text-size"></i> Font Size
                                </label>
                                <p class="toggle-hint">Adjust text size for readability</p>
                            </div>
                            <div class="font-size-control">
                                <input type="range" class="form-range" id="fontSizeSlider" min="12" max="18" value="14">
                                <span class="font-size-badge"><span id="fontSizeValue">14</span>px</span>
                            </div>
                        </div>

                        <!-- Option 4: Dark Mode -->
                        <div class="mobile-toggle-card">
                            <div class="toggle-left">
                                <label for="darkModeToggle" class="toggle-label">
                                    <i class="ri-moon-line"></i> Dark Mode
                                </label>
                                <p class="toggle-hint">Easy on the eyes in low light</p>
                            </div>
                            <div class="toggle-right">
                                <input class="form-check-input toggle-checkbox" type="checkbox" id="darkModeToggle">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Digital Signature Section -->
                <div class="feature-section">
                    <h6 class="feature-title">üîê Digital Signatures</h6>
                    <p class="feature-desc">Receipts include unique digital signatures</p>
                    <button class="btn btn-sm btn-secondary w-100" id="signatureInfoBtn">View Sample</button>
                </div>

                <!-- Additional Features -->
                <div class="feature-section">
                    <h6 class="feature-title">üìß Email Integration</h6>
                    <p class="feature-desc">Send receipts via email</p>
                    <input type="email" class="form-control form-control-sm mb-2" id="emailInput"
                        placeholder="Enter email">
                    <button class="btn btn-sm btn-warning w-100" id="emailReceiptBtn" disabled>Send Receipt</button>
                </div>

                <!-- Language Selection -->
                <div class="feature-section">
                    <h6 class="feature-title">üåê Language Support</h6>
                    <p class="feature-desc">Choose receipt language</p>
                    <select class="virtual-select" id="languageSelect" placeholder="Select language...">
                        <option value="en">English</option>
                        <option value="sw">Swahili</option>
                        <option value="lg">Luganda</option>
                    </select>
                </div>
            </div>
        </div>



        <!-- Sidebar Toggle Button (FAB) -->
        <button id="toggleSidebarBtn" class="sidebar-toggle-btn" title="Open Settings">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 1.5rem; height: 1.5rem;">
                <path d="M6.17071 18C6.58254 16.8348 7.69378 16 9 16C10.3062 16 11.4175 16.8348 11.8293 18H22V20H11.8293C11.4175 21.1652 10.3062 22 9 22C7.69378 22 6.58254 21.1652 6.17071 20H2V18H6.17071ZM12.1707 11C12.5825 9.83481 13.6938 9 15 9C16.3062 9 17.4175 9.83481 17.8293 11H22V13H17.8293C17.4175 14.1652 16.3062 15 15 15C13.6938 15 12.5825 14.1652 12.1707 13H2V11H12.1707ZM6.17071 4C6.58254 2.83481 7.69378 2 9 2C10.3062 2 11.4175 2.83481 11.8293 4H22V6H11.8293C11.4175 7.16519 10.3062 8 9 8C7.69378 8 6.58254 7.16519 6.17071 6H2V4H6.17071ZM9 6C9.55228 6 10 5.55228 10 5C10 4.44772 9.55228 4 9 4C8.44772 4 8 4.44772 8 5C8 5.55228 8.44772 6 9 6ZM15 13C15.5523 13 16 12.5523 16 12C16 11.4477 15.5523 11 15 11C14.4477 11 14 11.4477 14 12C14 12.5523 14.4477 13 15 13ZM9 20C9.55228 20 10 19.5523 10 19C10 18.4477 9.55228 18 9 18C8.44772 18 8 18.4477 8 19C8 19.5523 8.44772 20 9 20Z"></path>
            </svg>
        </button>
    </div>

    <!-- jsPDF Local -->
    <script src="vendor/jsPDF/jspdf.umd.js"></script>
    <script src="vendor/jsPDF/jspdf.plugin.autotable.min.js"></script>

    <!-- SheetJS Local -->
    <script src="vendor/sheetjs/xlsx.full.min.js"></script>

    <!-- QR Code Library Local -->
    <script src="vendor/qrcodejs/qrcodejs.min.js"></script>

    <!-- ECharts for Doughnut Charts -->
    <script src="vendor/echarts/dist/echarts.min.js"></script>

    <!-- Bootstrap JS (Local) -->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- SweetAlert2 JS (Local) -->
    <script src="vendor/sweetalert/dist/sweetalert2.all.min.js"></script>

    <!-- jQuery (required for Select2) -->
    <script src="vendor/jquery/jquery-3.7.1.min.js"></script>
    
    <!-- Select2 JS -->
    <script src="vendor/select2-develop/select2-develop/dist/js/select2.min.js"></script>
    
    <!-- Select2 Initialization - Handled per dropdown as needed -->

    <!-- Custom Scripts -->
    <script src="js/sweetalert-integration.js"></script>
    <script src="js/offline-resources.js"></script>
    <script src="js/custom-notifications.js"></script>
    <script src="js/offline-pdf-generator.js"></script>
    <script src="js/loan-member-fix.js"></script>
    <script src="js/offline-excel-generator.js"></script>
    <script src="js/jspdf-loader.js"></script>
    <script src="js/device-support.js"></script>
    <script src="js/indexeddb.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/excel-styling.js"></script>
    <script src="js/export.js"></script>
    <script src="js/receipts.js"></script>
    <script src="js/sidebar-features.js"></script>
    <script src="js/select2-init.js"></script>
    <script src="js/transactions.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/pwa-checker.js"></script>
    <script src="js/pwa-install.js"></script>
    <script src="js/app.js"></script>
    <script src="js/profit-chart.js"></script>
    <!-- Load advanced-charts.js AFTER indexeddb.js to ensure IndexedDBManager is available -->
    <script src="js/advanced-charts.js"></script>


    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          console.log('%cüì¶ Registering Service Worker...', 'color: #FFCC00; font-weight: bold');
          navigator.serviceWorker.register('./service-worker.js', { scope: './' })
            .then(registration => {
              console.log('%c‚úÖ Service Worker registered successfully', 'color: #51cf66; font-weight: bold');
              console.log('Scope:', registration.scope);
              
              // Mark that service worker is ready for PWA installation
              window.serviceWorkerReady = true;
              window.dispatchEvent(new Event('serviceWorkerReady'));
            })
            .catch(error => {
              console.error('%c‚ùå Service Worker registration failed:', 'color: #ff6b6b; font-weight: bold', error);
            });
        });
      } else {
        console.warn('Service Worker not supported in this browser');
      }
      
      // Initialize Create Loan Modal - load members when modal opens
      const createLoanModal = document.getElementById('createLoanModal');
      if (createLoanModal) {
        createLoanModal.addEventListener('show.bs.modal', async function() {
          console.log('[CreateLoanModal] Modal opened');
          const borrowerType = document.getElementById('borrowerType');
          const loanForm = document.getElementById('loanForm');
          
          // Reset form
          loanForm.reset();
          borrowerType.value = '';
          
          // Reset member select
          const loanMember = document.getElementById('loanMember');
          const memberWrapper = document.getElementById('loanMemberWrapper');
          const nonMemberWrapper = document.getElementById('nonMemberNameWrapper');
          
          memberWrapper.style.display = 'none';
          nonMemberWrapper.style.display = 'none';
          loanMember.innerHTML = '<option value="">Select Member</option>';
        });
      }
      
      // Wait for jQuery and Select2 to be available
      function ensureSelect2Ready() {
        if (typeof jQuery === 'undefined' || !jQuery.fn.select2) {
          console.log('[Select2] Waiting for jQuery and Select2...');
          setTimeout(ensureSelect2Ready, 100);
          return;
        }
        console.log('[Select2] jQuery and Select2 are ready');
        window.select2Ready = true;
        window.dispatchEvent(new Event('select2Ready'));
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', ensureSelect2Ready);
      } else {
        setTimeout(ensureSelect2Ready, 100);
      }
    </script>

    <!-- Splash Screen Handler -->
    <script>
      function hideSplashScreen() {
        const splashScreen = document.getElementById('splashScreen');
        if (splashScreen) {
          splashScreen.classList.add('hidden');
          // Remove after transition completes
          setTimeout(() => {
            splashScreen.style.display = 'none';
          }, 500);
        }
      }

      // Hide splash screen when DOM is fully loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', hideSplashScreen);
      } else {
        hideSplashScreen();
      }

      // Fallback: hide splash screen after 5 seconds max
      setTimeout(hideSplashScreen, 5000);
    </script>

    <!-- Create New Loan Modal -->
    <div class="modal fade" id="createLoanModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title fw-700"><i class="ri-add-circle-line" style="margin-right: 0.5rem;"></i>Create New Loan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="loanForm">
                        <div class="mb-3">
                            <label for="borrowerType" class="form-label fw-600">Borrower Type</label>
                            <select class="form-select form-select-lg" id="borrowerType" required onchange="App.updateBorrowerOptions()">
                                <option value="" disabled selected>Select borrower type...</option>
                                <option value="member">Member</option>
                                <option value="non-member">Non-Member</option>
                            </select>
                        </div>
                        <div class="mb-3" id="loanMemberWrapper">
                            <label for="loanMember" class="form-label fw-600">Member</label>
                            <select class="form-select form-select-lg" id="loanMember">
                                <option value="">Select member...</option>
                            </select>
                        </div>
                        <div class="mb-3" id="nonMemberNameWrapper" style="display: none;">
                            <label for="nonMemberName" class="form-label fw-600">Non-Member Name</label>
                            <input type="text" class="form-control form-control-lg" id="nonMemberName" placeholder="Enter full name" />
                        </div>
                        <div class="mb-3">
                            <label for="loanType" class="form-label fw-600">Loan Type</label>
                            <select class="form-select form-select-lg" id="loanType" required onchange="App.updateInterestRate()">
                                <option value="" disabled selected>Select loan type...</option>
                                <option value="normal">Normal Loan (2%)</option>
                                <option value="emergency">Emergency Loan (5%)</option>
                                <option value="non-member">Non-Member Loan (10%)</option>
                            </select>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="loanAmount" class="form-label fw-600">Amount (UGX)</label>
                                <input type="number" class="form-control form-control-lg" id="loanAmount"
                                    placeholder="Loan Amount" min="1" required>
                            </div>
                            <div class="col-md-6">
                                <label for="loanTerm" class="form-label fw-600">Term (months)</label>
                                <input type="number" class="form-control form-control-lg" id="loanTerm"
                                    placeholder="Loan Term" min="1" max="60" required>
                            </div>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <label for="interestRate" class="form-label fw-600">Interest Rate (%)</label>
                                <input type="number" class="form-control form-control-lg" id="interestRate"
                                    placeholder="Interest Rate" min="0" max="100" step="0.1" value="2" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="loanDate" class="form-label fw-600">Loan Date</label>
                                <input type="date" class="form-control form-control-lg" id="loanDate" required>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-3" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="ri-information-line" style="font-size: 1.2rem; margin-right: 0.5rem;"></i>
                                <div>
                                    <strong>Monthly Installment:</strong> <span id="monthlyInstallment" style="font-size: 1.1rem; color: #0c63e4; font-weight: 600;">UGX 0</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-top p-4 gap-2">
                    <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-lg" form="loanForm">Create Loan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Up Existing Loan Modal -->
    <div class="modal fade" id="topUpLoanModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-success text-white border-0">
                    <h5 class="modal-title fw-700"><i class="ri-wallet-2-line" style="margin-right: 0.5rem;"></i>Top Up Existing Loan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="topUpLoanForm">
                        <div class="mb-3">
                            <label for="topUpSelectLoan" class="form-label fw-600">Select Loan to Top Up</label>
                            <select class="virtual-select" id="topUpSelectLoan" placeholder="Search loan...">
                                <option value="" disabled selected>Choose a loan...</option>
                            </select>
                        </div>
                        <div class="alert alert-light border border-secondary mt-3 mb-3" role="alert">
                            <h6 class="alert-heading mb-3">
                                <i class="ri-file-list-line" style="margin-right: 0.5rem;"></i>Current Loan Details
                            </h6>
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <small class="text-muted d-block">Original Amount</small>
                                    <p class="h6 mb-0" id="topUpOriginalAmount" style="color: #2563eb; font-weight: 600;">-</p>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-muted d-block">Interest Rate</small>
                                    <p class="h6 mb-0" id="topUpInterestRate" style="color: #2563eb; font-weight: 600;">-</p>
                                </div>
                                <div class="col-md-12">
                                    <small class="text-muted d-block">Remaining Balance</small>
                                    <p class="h6 mb-0" id="topUpRemainingBalance" style="color: #dc2626; font-weight: 600;">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <label for="topUpAmount" class="form-label fw-600">Top Up Amount (UGX)</label>
                                <input type="number" class="form-control form-control-lg" id="topUpAmount"
                                    placeholder="Additional Amount" min="1" required>
                            </div>
                            <div class="col-md-6">
                                <label for="topUpDate" class="form-label fw-600">Top Up Date</label>
                                <input type="date" class="form-control form-control-lg" id="topUpDate" required>
                            </div>
                        </div>
                        <div class="alert alert-success mt-3 mb-3" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="ri-check-double-line" style="font-size: 1.2rem; margin-right: 0.5rem;"></i>
                                <div>
                                    <strong>New Total Amount:</strong> <span id="topUpNewTotal" style="font-size: 1.1rem; color: #15803d; font-weight: 600;">UGX 0</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-top p-4 gap-2">
                    <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success btn-lg" form="topUpLoanForm">Process Top Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Record Payment Modal -->
    <div class="modal fade" id="recordPaymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content border-0">
                <div class="modal-header bg-primary text-white border-0">
                    <h5 class="modal-title fw-700"><i class="ri-bank-card-line" style="margin-right: 0.5rem;"></i>Record Payment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="paymentForm">
                        <div class="mb-3">
                            <label for="paymentLoan" class="form-label fw-600">Select Loan</label>
                            <select class="virtual-select" id="paymentLoan" placeholder="Search loan...">
                                <option value="" disabled selected>Select loan...</option>
                            </select>
                        </div>
                        <div class="alert alert-light border border-secondary mt-3 mb-3" role="alert" id="paymentLoanDetails" style="display: none;">
                            <h6 class="alert-heading mb-3">
                                <i class="ri-file-list-line" style="margin-right: 0.5rem;"></i>Loan Details
                            </h6>
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <small class="text-muted d-block">Original Amount</small>
                                    <p class="h6 mb-0" id="paymentOriginalAmount" style="color: #2563eb; font-weight: 600;">-</p>
                                </div>
                                <div class="col-md-6">
                                    <small class="text-muted d-block">Outstanding Balance</small>
                                    <p class="h6 mb-0" id="paymentOutstandingBalance" style="color: #dc2626; font-weight: 600;">-</p>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-md-6">
                                <label for="paymentAmount" class="form-label fw-600">Amount (UGX)</label>
                                <input type="number" class="form-control form-control-lg" id="paymentAmount"
                                    placeholder="Payment Amount" min="1" required>
                            </div>
                            <div class="col-md-6">
                                <label for="paymentDate" class="form-label fw-600">Payment Date</label>
                                <input type="date" class="form-control form-control-lg" id="paymentDate" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-top p-4 gap-2">
                    <button type="button" class="btn btn-secondary btn-lg" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary btn-lg" form="paymentForm">Record Payment</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
